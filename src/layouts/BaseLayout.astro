---
import "@fontsource-variable/inter";
import "@fontsource-variable/inter/wght-italic.css";
import "@fontsource-variable/spline-sans-mono";
import "@fontsource-variable/spline-sans-mono/wght-italic.css";
import "@fontsource/maple-mono/400.css";
import "@fontsource/maple-mono/500.css";
import "@fontsource/maple-mono/700.css";
import "@fontsource/maple-mono/400-italic.css";
import "@fontsource/maple-mono/500-italic.css";
import "@fontsource/maple-mono/700-italic.css";
import { intersection } from "astro:schema";
import "../styles/global.css";
const { title } = Astro.props;
const currentPath = Astro.url.pathname;
import CommandMenu from "../components/CommandMenu";
---

<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <script is:inline>
      const theme = (() => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: light)").matches) {
          return "light";
        }
        return "dark";
      })();

      if (theme === "light") {
        document.documentElement.setAttribute("data-theme", "light");
      } else {
        document.documentElement.setAttribute("data-theme", "dark");
      }
      window.localStorage.setItem("theme", theme);
    </script>
  </head>
  <body class="bg-[#050505] text-signal font-mono antialiased overflow-hidden">
    <div
      class="md:grid md:grid-cols-[280px_minmax(0,1fr)] content-start md:content-stretch h-screen max-w-[1600px] mx-auto md:border-x border-border bg-void"
    >
      <aside
        id="sidebar"
        class="sticky md:relative top-0 left-0 w-full md:w-auto border-b md:border-b-0 md:border-r border-border p-6 md:p-8 flex flex-col bg-void z-50 transition-all duration-300 h-fit md:h-full"
      >
        <div
          class="flex flex-row md:flex-col justify-between items-center md:items-start w-full shrink-0"
        >
          <div>
            <div class="text-[0.65rem] text-muted mb-1 tracking-wider">
              <span
                class="inline-block w-1.5 h-1.5 bg-accent rounded-full mr-2 animate-pulse font-mono"
              ></span>
              SYSTEM_ONLINE
            </div>
            <a
              href="/"
              class="font-sans font-extrabold text-xl md:text-2xl leading-none tracking-tighter"
            >
              SUMEET / SINGH
            </a>
          </div>

          <button
            id="menu-toggle"
            class="md:hidden text-xs border border-border text-accent px-3 py-1 font-mono hover:bg-white/5 transition-colors"
          >
            [::] EXPAND
          </button>
        </div>

        <div
          id="sidebar-content"
          class="hidden md:flex flex-col justify-between grow mt-8 md:mt-0 pt-1.5 md:pt-0 border-t md:border-t-0 border-border overflow-y-auto max-h-[70vh] md:max-h-none"
        >
          <nav class="flex flex-col gap-3 mt-8 font-medium font-mono">
            <a
              href="/"
              class={`flex items-center transition-all duration-200 hover:cursor-pointer ${currentPath == "/" ? "text-signal font-bold" : "text-muted hover:text-signal hover:pl-2"}`}
            >
              {currentPath == "/" && <span class="text-accent mr-2">█</span>}
              01_ABOUT
            </a>

            <a
              href="/projects"
              class={`flex items-center transition-all duration-200 hover:cursor-pointer ${currentPath.startsWith("/projects") ? "text-signal font-bold" : "text-muted hover:text-signal hover:pl-2"}`}
            >
              {
                currentPath.startsWith("/projects") && (
                  <span class="text-accent mr-2">█</span>
                )
              }
              02_PROJECTS
            </a>
            <a
              href="/blog"
              class={`flex items-center transition-all duration-200 hover:cursor-pointer ${currentPath.startsWith("/blog") ? "text-signal font-bold" : "text-muted hover:text-signal hover:pl-2"}`}
            >
              {
                currentPath.startsWith("/blog") && (
                  <span class="text-accent mr-2">█</span>
                )
              }
              03_LOGS
            </a>
          </nav>

          <div class="text-xs text-muted mt-8 md:mt-auto pb-4 md:pb-0">
            <button
              id="theme-toggle"
              class="flex items-center gap-2 border border-border px-2 py-1 hover:text-signal hover:border-signal transition-colors mb-4"
            >
              <span id="theme-icon">[ ]</span> MODE
            </button>
            <div>
              IP: <span id="user-ip">127.0.0.1</span><br />
              SYS: <span id="clock">00:00</span>
            </div>
          </div>
        </div>
      </aside>

      <main
        id="main-viewport"
        class="flex flex-col overflow-y-auto p-6 md:p-24 relative pt-8 md:pt-24 pb-32 md:pb-24 scroll-smooth"
      >
        <slot />
        <div
          id="scroll-indicator"
          class="hidden md:flex fixed bottom-12 right-12 flex-col items-center gap-2 pointer-events-none opacity-0 transition-opacity duration-500 z-40"
        >
          <span
            class="text-[12px] text-accent font-mono tracking-widest animate-pulse"
            >SCROLL_DOWN</span
          >
          <span class="text-accent text-xl animate-pulse">↓</span>
        </div>
      </main>
    </div>

    <script>
      console.log(
        "%c SUMEET SINGH %c SYSTEM_READY ",
        "background: #ff4d00; color: #050505; font-weight: 900; padding: 4px 8px; font-family: monospace; border-radius: 2px;",
        "background: #050505; color: #ff4d00; padding: 4px 8px; border: 1px solid #ff4d00; font-family: monospace; border-radius: 2px;"
      );

      const themeBtn = document.getElementById("theme-toggle");
      const html = document.documentElement;
      const icon = document.getElementById("theme-icon");

      const currentTheme = localStorage.getItem("theme");
      if (icon) {
        icon.innerText = currentTheme === "light" ? "[☾]" : "[☼]";
      }

      themeBtn?.addEventListener("click", () => {
        const current = html.getAttribute("data-theme");
        if (current === "dark") {
          html.setAttribute("data-theme", "light");
          localStorage.setItem("theme", "light");
          if (icon) icon.innerText = "[☾]";
        } else {
          html.setAttribute("data-theme", "dark");
          localStorage.setItem("theme", "dark");
          if (icon) icon.innerText = "[☼]";
        }
      });

      const menuBtn = document.getElementById("menu-toggle");
      const sidebar = document.getElementById("sidebar");
      const content = document.getElementById("sidebar-content");
      const mainViewport = document.getElementById("main-viewport");
      menuBtn?.addEventListener("click", () => {
        const isExpanded = !content?.classList.contains("hidden");

        if (!isExpanded) {
          // EXPAND
          content?.classList.remove("hidden");
          content?.classList.add("flex");
          if (menuBtn) menuBtn.innerText = "[-] COLLAPSE";
          //   mainViewport?.classList.add("opacity-[0.1]");
        } else {
          // COLLAPSE
          content?.classList.add("hidden");
          content?.classList.remove("flex");
          if (menuBtn) menuBtn.innerText = "[::] EXPAND";
          //   mainViewport?.classList.remove("opacity-[0.1]");
        }
      });

      const scrollIndicator = document.getElementById("scroll-indicator");
      const checkScroll = () => {
        if (!mainViewport || !scrollIndicator) return;
        const scrollableDistance =
          mainViewport.scrollHeight - mainViewport.clientHeight;
        if (scrollableDistance < 50) {
          scrollIndicator.style.opacity = "0";
          return;
        }
        const isScrolledDown = mainViewport.scrollTop > 50;
        const isNearBottom =
          mainViewport.scrollTop + mainViewport.clientHeight >=
          mainViewport.scrollHeight - 20;
        if (isScrolledDown || isNearBottom) {
          scrollIndicator.style.opacity = "0";
        } else {
          scrollIndicator.style.opacity = "1";
        }
      };
      if (mainViewport) {
        checkScroll();
        mainViewport.addEventListener("scroll", checkScroll);
        window.addEventListener("resize", checkScroll);
      }

      setInterval(() => {
        const clock = document.getElementById("clock");
        if (clock) {
          const d = new Date();
          clock.innerText =
            d.getHours().toString().padStart(2, "0") +
            ":" +
            d.getMinutes().toString().padStart(2, "0");
        }
      }, 1000);
      fetch("https://api.ipify.org?format=json")
        .then((response) => response.json())
        .then((data) => {
          const ipSpan = document.getElementById("user-ip");
          if (ipSpan) ipSpan.innerText = data.ip;
        })
        .catch((error) => {
          console.log("System Info: IP detection blocked by client.", error);
        });
    </script>
    <CommandMenu client:idle />
  </body>
</html>

<style is:global>
  :root {
    --bg: #050505;
    --text-main: #eeeeee;
    --text-muted: #9c9c9c;
    --border: #222222;
    --accent: #ff4d00;
  }

  [data-theme="light"] {
    --bg: #fafafa;
    --text-main: #111111;
    --text-muted: #555555;
    --border: #e0e0e0;
    --accent: #ff4d00;
  }
  .grid-cols-layout {
    grid-template-columns: 280px 1fr;
  }
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(0.5rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
